#!/bin/bash

# Script d'envoi de notification Telegram Ã  tous les clients
# Message: Casablanca - Livreur disponible ce soir

TOKEN="8520529140:AAHH9kc3SJdkjEna_AjDZXOpvIIOdi5YVBs"
MESSAGE=$'ğŸŸ¢ğŸŸ¢ ACTIEF ! DISPONIBLE ! ğŸŸ¢ğŸŸ¢\nCasablanca: Livreur dispo pour ce soir'
BUTTON='{"inline_keyboard":[[{"text":"ğŸ“± Menu","url":"https://tangerine1890.github.io/tangerine-v2"}]]}'

# Liste de tous les chat_id
CHAT_IDS=(
  1007288448 1049290153 1081916584 1137757546 1143720573 1242214842 1267043904 1274967451
  1292510213 1300255688 1311090028 1326144889 1356417699 138840350 1447113539 1456005758
  1582143772 1602955460 1606710306 1625551049 1697235424 1742855726 1848280712 1870566422
  1941815067 1996785410 2002953632 2027172830 2051861570 2073382772 2085188019 262704129
  409038562 419580081 5068708902 5092486456 5134242145 5177597899 5181493787 5216943859
  5233074981 5241477301 5264901160 531073013 5341115205 5416426276 5420729947 5476932119
  5703616945 5721318154 5756470908 57588710 5847977072 5869544551 5872045142 5967976776
  5981722229 600008647 6022268736 6151251584 6214893970 6397118412 6404725453 6413868634
  6418796302 6453323777 6511524051 651527431 6585743235 6622208158 6690987564 6757328157
  6783112617 6789735198 6841508033 6866061854 6894161234 7011818135 7064776861 7143183551
  717271088 7280755738 7322385891 7364337124 7402010309 7418460544 7419918150 742980393
  7450534189 7450620817 7456438297 7487340659 7514190920 7531414893 7570295588 7589098340
  7699804442 7710751780 7711008503 7775786301 7787776600 7795830145 7797427929 7814695495
  7830760592 7856291908 7876510716 7944186564 7955262700 795889334 7982026619 8020394155
  8053418929 8070686364 8097230581 8101280363 8148766075 8199494989 8200654584 8201684947
  8210918824 8218087948 8250775686 8303092467 8392377187 8425927806 8438580701 8480452119
  8488591122 8507858775 8509596763 8535573052 858385506 870729265 936816664 959111014
  978091625
)

TOTAL=${#CHAT_IDS[@]}
SENT=0
FAILED=0

echo "ğŸš€ DÃ©but de l'envoi Ã  $TOTAL utilisateurs..."
echo ""

for chat_id in "${CHAT_IDS[@]}"; do
  echo -n "ğŸ“¤ Envoi Ã  $chat_id... "
  
  RESPONSE=$(curl -s -X POST "https://api.telegram.org/bot${TOKEN}/sendMessage" \
    -d "chat_id=$chat_id" \
    -d "text=$MESSAGE" \
    -d "reply_markup=$BUTTON")
  
  if echo "$RESPONSE" | grep -q '"ok":true'; then
    echo "âœ…"
    ((SENT++))
  else
    echo "âŒ Erreur"
    ((FAILED++))
  fi
  
  # Pause de 0.5 seconde pour Ã©viter le rate limiting
  sleep 0.5
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Envoi terminÃ© !"
echo "ğŸ“Š Statistiques :"
echo "   â€¢ Total : $TOTAL utilisateurs"
echo "   â€¢ EnvoyÃ©s : $SENT âœ…"
echo "   â€¢ Ã‰chouÃ©s : $FAILED âŒ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
